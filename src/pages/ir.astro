---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import PageHero from "../components/PageHero.astro";
import CTASection from "../components/CTASection.astro";
import { company, pageMeta, irDocuments, irFAQs, irDisclaimer, irCompanyLinks } from "../data/content.ts";

const irIcon = `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>`;

// グループ化: お知らせ・プレスリリースを年別に整理
const documentsByYear = irDocuments.reduce((acc, doc) => {
  const year = doc.date.split('-')[0];
  if (!acc[year]) acc[year] = [];
  acc[year].push(doc);
  return acc;
}, {} as Record<string, typeof irDocuments>);

// 年を降順でソート
const sortedYears = Object.keys(documentsByYear).sort((a, b) => parseInt(b) - parseInt(a));
---

<Layout title={pageMeta.ir.title} description={pageMeta.ir.description}>
  <Header />
  <main>
    <PageHero
      titleHtml='<span class="gradient-text">投資家向け情報 / 法定公告</span>'
      subtitleHtml="当社の法定公告（決算公告）および投資家向け情報を掲載しています。<br /><span class='text-muted'>未上場企業のため、上場企業向け開示（決算短信・有価証券報告書等）は行っていません。</span>"
      badge="法定公告"
      badgeIconHtml={irIcon}
    />

    <!-- Disclaimer Section -->
    <section class="section section-alt">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">
            <span class="gradient-text">{irDisclaimer.title}</span>
          </h2>
        </div>

        <div class="disclaimer-card">
          <ul class="disclaimer-list">
            {irDisclaimer.items.map((item) => (
              <li class="disclaimer-item">
                <svg class="disclaimer-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>{item}</span>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </section>

    <!-- Company Info Section -->
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">
            <span class="gradient-text">会社情報</span>
          </h2>
          <p class="section-description">
            当社の詳細情報は以下のページでご確認いただけます
          </p>
        </div>

        <div class="company-links-grid">
          {irCompanyLinks.map((link) => (
            <a href={link.href} class="company-link-card">
              <div class="company-link-icon" set:html={link.icon}></div>
              <div class="company-link-content">
                <h3 class="company-link-title">{link.title}</h3>
                <p class="company-link-description">{link.description}</p>
              </div>
              <svg class="company-link-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          ))}
        </div>

        <div class="company-summary">
          <div class="company-summary-grid">
            <div class="company-summary-item">
              <span class="company-summary-label">社名</span>
              <span class="company-summary-value">{company.name}</span>
            </div>
            <div class="company-summary-item">
              <span class="company-summary-label">設立</span>
              <span class="company-summary-value">{company.established}年7月</span>
            </div>
            <div class="company-summary-item">
              <span class="company-summary-label">代表取締役</span>
              <span class="company-summary-value">{company.representative}</span>
            </div>
            <div class="company-summary-item">
              <span class="company-summary-label">所在地</span>
              <span class="company-summary-value">{company.address.full}</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- News & Press Releases Section -->
    <section class="section section-alt">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">
            <span class="gradient-text">お知らせ・プレスリリース</span>
          </h2>
          <p class="section-description">
            当社に関するお知らせ・プレスリリース等を時系列で掲載しています。<br />
            <span class="text-muted">※未上場企業のため、決算短信・有価証券報告書などの上場企業向け開示資料は作成していません。</span>
          </p>
        </div>

        <div class="news-section">
          {irDocuments.length > 0 ? (
            <div class="news-list">
              {sortedYears.map((year) => (
                <div class="news-year-group">
                  <h3 class="news-year-title">{year}年</h3>
                  <div class="news-items">
                    {documentsByYear[year].map((doc) => (
                      <div class="news-item">
                        <div class="news-item-header">
                          <span class="news-date">{doc.date}</span>
                          <span class="news-type" data-type={doc.type}>{doc.type}</span>
                        </div>
                        <h4 class="news-title">{doc.title}</h4>
                        {doc.summary && <p class="news-summary">{doc.summary}</p>}
                        <div class="news-actions">
                          {doc.htmlUrl && (
                            <a href={doc.htmlUrl} class="news-link" target="_blank" rel="noopener noreferrer">
                              詳細を見る
                              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                              </svg>
                            </a>
                          )}
                          {doc.pdfUrl && (
                            <a href={doc.pdfUrl} class="news-link news-link-pdf" target="_blank" rel="noopener noreferrer">
                              PDF
                              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                              </svg>
                            </a>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div class="news-empty">
              <div class="empty-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
              </div>
              <h3 class="empty-title">お知らせはまだありません</h3>
              <p class="empty-description">
                当社は2025年7月に設立されたばかりのため、公開情報はまだございません。<br />
                第1期の決算公告は2026年に公開予定です。
              </p>
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- FAQ Section -->
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">
            <span class="gradient-text">よくある質問（FAQ）</span>
          </h2>
          <p class="section-description">
            投資家の方からよくいただく質問と回答
          </p>
        </div>

        <div class="faq-list">
          {irFAQs.map((faq, index) => (
            <div class="faq-item">
              <button class="faq-question" data-faq-index={index}>
                <span class="faq-q">Q{index + 1}</span>
                <span class="faq-text">{faq.question}</span>
                <svg class="faq-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="faq-answer" data-faq-answer={index}>
                <div class="faq-answer-content" set:html={faq.answer}></div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <CTASection
      titleHtml="IRに関するお問い合わせ"
      subtitleHtml="投資家向け情報に関するご質問・ご相談は<br />お気軽にお問い合わせください。"
      primaryText="お問い合わせ"
      primaryHref="/contact"
      secondaryText="会社概要を見る"
      secondaryHref="/about"
    />
  </main>
  <Footer />
</Layout>

<style>
  /* Disclaimer Section */
  .disclaimer-card {
    max-width: 64rem;
    margin: 0 auto;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
    padding: 2rem;
  }

  .disclaimer-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .disclaimer-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    color: var(--text-secondary);
    line-height: 1.7;
  }

  .disclaimer-icon {
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
    color: var(--primary);
    margin-top: 0.125rem;
  }

  /* Company Info Section */
  .company-links-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
  }

  .company-link-card {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    padding: 1.5rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
    text-decoration: none;
    transition: all var(--motion-duration) var(--motion-ease);
  }

  .company-link-card:hover {
    transform: translateY(-4px);
    border-color: var(--border-hover);
    box-shadow: var(--shadow-lg);
  }

  .company-link-icon {
    width: 3rem;
    height: 3rem;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 212, 170, 0.15);
    border-radius: var(--radius-lg);
    color: var(--primary);
  }

  .company-link-icon :global(svg) {
    width: 1.5rem;
    height: 1.5rem;
  }

  .company-link-content {
    flex: 1;
  }

  .company-link-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 0.25rem;
  }

  .company-link-description {
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.5;
  }

  .company-link-arrow {
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
    color: var(--text-muted);
    transition: transform var(--motion-duration) var(--motion-ease);
  }

  .company-link-card:hover .company-link-arrow {
    transform: translateX(4px);
    color: var(--primary);
  }

  .company-summary {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
    padding: 2rem;
  }

  .company-summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .company-summary-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .company-summary-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--primary);
  }

  .company-summary-value {
    font-size: 1rem;
    color: var(--text);
  }

  /* News Section */
  .news-section {
    max-width: 64rem;
    margin: 0 auto;
  }

  .news-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .news-year-group {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .news-year-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text);
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--border);
  }

  .news-items {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .news-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    transition: all var(--motion-duration) var(--motion-ease);
  }

  .news-item:hover {
    border-color: var(--border-hover);
    box-shadow: var(--shadow-md);
  }

  .news-item-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.75rem;
  }

  .news-date {
    font-size: 0.875rem;
    color: var(--text-muted);
  }

  .news-type {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: 600;
  }

  .news-type[data-type="お知らせ"] {
    background: rgba(99, 91, 255, 0.15);
    color: var(--secondary);
  }

  .news-type[data-type="プレスリリース"] {
    background: rgba(0, 212, 170, 0.15);
    color: var(--primary);
  }

  .news-type[data-type="法定公告"] {
    background: rgba(255, 159, 67, 0.15);
    color: #ff9f43;
  }

  .news-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 0.5rem;
  }

  .news-summary {
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .news-actions {
    display: flex;
    gap: 1rem;
  }

  .news-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--primary);
    text-decoration: none;
    transition: all var(--motion-duration) var(--motion-ease);
  }

  .news-link:hover {
    opacity: 0.8;
  }

  .news-link svg {
    width: 1rem;
    height: 1rem;
  }

  .news-link-pdf {
    color: var(--text-secondary);
  }

  .news-empty {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
  }

  .empty-icon {
    color: var(--text-muted);
    margin-bottom: 1.5rem;
  }

  .empty-icon svg {
    width: 4rem;
    height: 4rem;
  }

  .empty-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 1rem;
  }

  .empty-description {
    color: var(--text-secondary);
    line-height: 1.7;
    max-width: 32rem;
    margin: 0 auto;
  }

  /* FAQ Section */
  .faq-list {
    max-width: 48rem;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .faq-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all var(--motion-duration) var(--motion-ease);
  }

  .faq-item:hover {
    border-color: var(--border-hover);
  }

  .faq-question {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: transparent;
    border: none;
    text-align: left;
    cursor: pointer;
    color: var(--text);
    font-size: 1rem;
    font-weight: 600;
    transition: all var(--motion-duration) var(--motion-ease);
  }

  .faq-question:hover {
    background: var(--surface-light);
  }

  .faq-q {
    flex-shrink: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    background: rgba(0, 212, 170, 0.15);
    color: var(--primary);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 700;
  }

  .faq-text {
    flex: 1;
  }

  .faq-icon {
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
    transition: transform var(--motion-duration) var(--motion-ease);
    color: var(--text-muted);
  }

  .faq-item.active .faq-icon {
    transform: rotate(180deg);
  }

  .faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height var(--motion-duration-slow) var(--motion-ease);
  }

  .faq-item.active .faq-answer {
    max-height: 500px;
  }

  .faq-answer-content {
    padding: 0 1.5rem 1.5rem 4.5rem;
    color: var(--text-secondary);
    line-height: 1.8;
  }

  .faq-answer-content :global(.link) {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
  }

  .faq-answer-content :global(.link:hover) {
    text-decoration: underline;
  }

  /* Utility */
  .text-muted {
    color: var(--text-muted);
    font-size: 0.875rem;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .company-links-grid {
      grid-template-columns: 1fr;
    }

    .company-link-card {
      padding: 1.25rem;
    }

    .company-summary-grid {
      grid-template-columns: 1fr;
    }

    .faq-question {
      padding: 1rem;
    }

    .faq-answer-content {
      padding: 0 1rem 1rem 3.5rem;
    }

    .news-item-header {
      flex-wrap: wrap;
    }
  }
</style>

<script>
  // FAQ Accordion
  document.addEventListener('DOMContentLoaded', () => {
    const faqQuestions = document.querySelectorAll('.faq-question');
    
    faqQuestions.forEach((question) => {
      question.addEventListener('click', () => {
        const faqItem = question.closest('.faq-item');
        const isActive = faqItem?.classList.contains('active');
        
        // Close all FAQ items
        document.querySelectorAll('.faq-item').forEach((item) => {
          item.classList.remove('active');
        });
        
        // Toggle current item
        if (!isActive) {
          faqItem?.classList.add('active');
        }
      });
    });
  });
</script>
