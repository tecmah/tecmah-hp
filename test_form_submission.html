<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>フォーム送信テスト</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-case {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }

        .test-case h3 {
            margin-top: 0;
            color: #333;
        }

        .form-group {
            margin: 10px 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>

<body>
    <h1>Google Forms送信テスト</h1>

    <div class="test-case">
        <h3>テストケース1: 完全なデータ送信</h3>
        <form id="test-form-1">
            <div class="form-group">
                <label for="company_name_1">会社名:</label>
                <input type="text" id="company_name_1" name="company_name" value="テスト株式会社" required>
            </div>
            <div class="form-group">
                <label for="contact_name_1">お名前:</label>
                <input type="text" id="contact_name_1" name="contact_name" value="田中太郎" required>
            </div>
            <div class="form-group">
                <label for="email_1">メールアドレス:</label>
                <input type="email" id="email_1" name="email" value="test@example.com" required>
            </div>
            <div class="form-group">
                <label for="industry_1">業界・業種:</label>
                <select id="industry_1" name="industry" required>
                    <option value="IT・ソフトウェア">IT・ソフトウェア</option>
                </select>
            </div>
            <div class="form-group">
                <label for="company_size_1">従業員規模:</label>
                <select id="company_size_1" name="company_size" required>
                    <option value="スタートアップ（〜20名）">スタートアップ（〜20名）</option>
                </select>
            </div>
            <div class="form-group">
                <label>相談内容:</label>
                <input type="checkbox" name="consultation_category" value="AI・データ活用" checked> AI・データ活用
            </div>
            <div class="form-group">
                <label for="budget_range_1">予算規模:</label>
                <select id="budget_range_1" name="budget_range" required>
                    <option value="100万円未満">100万円未満</option>
                </select>
            </div>
            <div class="form-group">
                <label for="message_1">相談内容・課題について:</label>
                <textarea id="message_1" name="message" required>AI導入について相談したいです。</textarea>
            </div>
            <div class="form-group">
                <label for="privacy_agreement_1">プライバシーポリシー同意:</label>
                <input type="checkbox" id="privacy_agreement_1" name="privacy_agreement" checked> 同意する
            </div>
            <button type="submit">テスト送信1</button>
        </form>
        <div id="result-1" class="result" style="display: none;"></div>
    </div>

    <div class="test-case">
        <h3>テストケース2: 最小限のデータ送信</h3>
        <form id="test-form-2">
            <div class="form-group">
                <label for="company_name_2">会社名:</label>
                <input type="text" id="company_name_2" name="company_name" value="最小テスト会社" required>
            </div>
            <div class="form-group">
                <label for="contact_name_2">お名前:</label>
                <input type="text" id="contact_name_2" name="contact_name" value="最小太郎" required>
            </div>
            <div class="form-group">
                <label for="email_2">メールアドレス:</label>
                <input type="email" id="email_2" name="email" value="minimal@example.com" required>
            </div>
            <div class="form-group">
                <label for="industry_2">業界・業種:</label>
                <select id="industry_2" name="industry" required>
                    <option value="製造業">製造業</option>
                </select>
            </div>
            <div class="form-group">
                <label for="company_size_2">従業員規模:</label>
                <select id="company_size_2" name="company_size" required>
                    <option value="小規模企業（21〜100名）">小規模企業（21〜100名）</option>
                </select>
            </div>
            <div class="form-group">
                <label>相談内容:</label>
                <input type="checkbox" name="consultation_category" value="PdM・PM支援" checked> PdM・PM支援
            </div>
            <div class="form-group">
                <label for="budget_range_2">予算規模:</label>
                <select id="budget_range_2" name="budget_range" required>
                    <option value="100万円〜300万円">100万円〜300万円</option>
                </select>
            </div>
            <div class="form-group">
                <label for="message_2">相談内容・課題について:</label>
                <textarea id="message_2" name="message" required>最小限のテストメッセージ</textarea>
            </div>
            <div class="form-group">
                <label for="privacy_agreement_2">プライバシーポリシー同意:</label>
                <input type="checkbox" id="privacy_agreement_2" name="privacy_agreement" checked> 同意する
            </div>
            <button type="submit">テスト送信2</button>
        </form>
        <div id="result-2" class="result" style="display: none;"></div>
    </div>

    <div class="test-case">
        <h3>テストケース3: エラーケース（必須フィールド未入力）</h3>
        <form id="test-form-3">
            <div class="form-group">
                <label for="company_name_3">会社名:</label>
                <input type="text" id="company_name_3" name="company_name" value="" required>
            </div>
            <div class="form-group">
                <label for="contact_name_3">お名前:</label>
                <input type="text" id="contact_name_3" name="contact_name" value="エラーテスト" required>
            </div>
            <div class="form-group">
                <label for="email_3">メールアドレス:</label>
                <input type="email" id="email_3" name="email" value="error@example.com" required>
            </div>
            <div class="form-group">
                <label for="industry_3">業界・業種:</label>
                <select id="industry_3" name="industry" required>
                    <option value="金融・保険業">金融・保険業</option>
                </select>
            </div>
            <div class="form-group">
                <label for="company_size_3">従業員規模:</label>
                <select id="company_size_3" name="company_size" required>
                    <option value="中堅企業（101〜500名）">中堅企業（101〜500名）</option>
                </select>
            </div>
            <div class="form-group">
                <label>相談内容:</label>
                <input type="checkbox" name="consultation_category" value="DX・新規事業" checked> DX・新規事業
            </div>
            <div class="form-group">
                <label for="budget_range_3">予算規模:</label>
                <select id="budget_range_3" name="budget_range" required>
                    <option value="300万円〜500万円">300万円〜500万円</option>
                </select>
            </div>
            <div class="form-group">
                <label for="message_3">相談内容・課題について:</label>
                <textarea id="message_3" name="message" required>エラーテストメッセージ</textarea>
            </div>
            <div class="form-group">
                <label for="privacy_agreement_3">プライバシーポリシー同意:</label>
                <input type="checkbox" id="privacy_agreement_3" name="privacy_agreement" checked> 同意する
            </div>
            <button type="submit">テスト送信3（エラーケース）</button>
        </form>
        <div id="result-3" class="result" style="display: none;"></div>
    </div>

    <script>
        // Google Forms送信関数
        async function submitToGoogleForms(formData, resultId) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = '送信中...';

            try {
                // Google Forms用のデータマッピング
                const googleFormData = new FormData();

                // 基本情報
                googleFormData.append("entry.613070658", formData.get("company_name") || "");
                googleFormData.append("entry.2116052852", formData.get("department") || "");
                googleFormData.append("entry.1182563392", formData.get("contact_name") || "");
                googleFormData.append("entry.244536876", formData.get("position") || "");
                googleFormData.append("entry.1558582620", formData.get("email") || "");

                // 会社情報
                googleFormData.append("entry.1997662257", formData.get("industry") || "");
                googleFormData.append("entry.1893426852", formData.get("company_size") || "");

                // 相談詳細
                const categories = Array.from(
                    document.querySelectorAll('input[name="consultation_category"]:checked')
                ).map(cb => cb.value);
                if (categories.length > 0) {
                    categories.forEach(v => googleFormData.append("entry.248267075", v));
                } else {
                    googleFormData.append("entry.248267075", "");
                }

                googleFormData.append("entry.1767368493", formData.get("budget_range") || "");
                googleFormData.append("entry.1087875316", formData.get("timeline") || "");
                googleFormData.append("entry.1394113561", formData.get("message") || "");

                // 会議設定
                googleFormData.append("entry.430505463", formData.get("preferred_meeting") || "");

                // プライバシーポリシー同意
                googleFormData.append("entry.831363846", formData.get("privacy_agreement") ? "プライバシーポリシーに同意します" : "");

                // Hidden fields are not required for single-page forms

                console.log("送信データ:", Object.fromEntries(googleFormData.entries()));

                // 送信実行
                const response = await fetch(
                    "https://docs.google.com/forms/d/e/1FAIpQLScaWcLHfLO7ZizP3yv86hKwvCnhjeFNq3U1zi3ENC1_8qKKnw/formResponse",
                    {
                        method: "POST",
                        mode: "no-cors",
                        body: googleFormData,
                    }
                );

                // iframe方式でも送信
                const iframe = document.createElement("iframe");
                iframe.style.display = "none";
                iframe.name = "hidden_iframe_" + Date.now();
                document.body.appendChild(iframe);

                const form = document.createElement("form");
                form.method = "POST";
                form.action = "https://docs.google.com/forms/d/e/1FAIpQLScaWcLHfLO7ZizP3yv86hKwvCnhjeFNq3U1zi3ENC1_8qKKnw/formResponse";
                form.target = iframe.name;

                for (let [key, value] of googleFormData.entries()) {
                    const input = document.createElement("input");
                    input.type = "hidden";
                    input.name = key;
                    input.value = value;
                    form.appendChild(input);
                }

                document.body.appendChild(form);
                form.submit();

                // クリーンアップ
                setTimeout(() => {
                    if (document.body.contains(form)) document.body.removeChild(form);
                    if (document.body.contains(iframe)) document.body.removeChild(iframe);
                }, 2000);

                resultDiv.className = 'result success';
                resultDiv.textContent = '送信完了！Google Formsで回答を確認してください。';

            } catch (error) {
                console.error("送信エラー:", error);
                resultDiv.className = 'result error';
                resultDiv.textContent = '送信に失敗しました: ' + error.message;
            }
        }

        // フォーム送信イベント
        document.getElementById('test-form-1').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            submitToGoogleForms(formData, 'result-1');
        });

        document.getElementById('test-form-2').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            submitToGoogleForms(formData, 'result-2');
        });

        document.getElementById('test-form-3').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            submitToGoogleForms(formData, 'result-3');
        });
    </script>
</body>

</html>